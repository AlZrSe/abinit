<html>
<head><title>multidtset </title>
<link rel=stylesheet type="text/css" href="../formabinit.css">
</head>
<body bgcolor="#ffffff">

<hr>
<a name="top"></a>

<h1>Multi-dataset calculations</h1>
<h3>This file gives hints on how to set parameters for a multi dataset calculation with the ABINIT package.
<hr>

<h5>Copyright (C) 2016-2017 ABINIT group (FJ)
<script type="text/javascript" src="../../js_files/copyright.js"> </script>
</h5>

<script type="text/javascript" src="../../js_files/list_internal_links_for_generated_files.js"> </script>

 <h3><b>Table of content: </b></h3> 
 <ul> <li><a href="topic_multidtset.html#1">1</a>. Introduction.<li><a href="topic_multidtset.html#2">2</a>. Related input variables.<li><a href="topic_multidtset.html#3">3</a>. Selected input files.</ul>

&nbsp; 
<HR ALIGN=left> 
<a name="1">&nbsp;</a>
<h3><b>1. Introduction.</b></h3>


</ul>

<p><h3><b><a name="multidataset"></a>The multi-dataset mode.</b></h3>
<p>Until now, we have assumed that the user wants to make computations corresponding
to one set of data : for example, determination of the total energy for some
geometry, with some set of plane waves and some set of k-points. </p>
<p>It is often needed to redo the calculations for different values of some
parameter, letting all the other things equal. As typical examples, we have
convergence studies needed to determine which cut-off energy gives the needed
accuracy. In other cases, one makes chains of calculations in order to compute
the band structure : first a self-consistent calculation of the density and
potential, then the eigenenergy computation along different lines. </p>
<p>For that purpose, the <b>multi-dataset mode</b> has been implemented. </p>
<p>It allows the code to treat, in one run, different sets of data, and to chain
them. The number of datasets to be treated is specified by the variable
<a href="../../input_variables/generated_files/varbas.html#ndtset">ndtset</a>,
while the indices of the datasets (by default 1, 2, 3,
and so on) can be eventually provided by the array <a href="../../input_variables/generated_files/varbas.html#jdtset">jdtset</a>.
</p>
<p>For each dataset to be treated, characterized by some index, each input variable
will determined by the following <b>rules</b> (actually, it is easier to understand
when one looks at examples, see below) : </p>
<ul>
<li> (<a name="ref8_1"></a>1) ABINIT looks whether the variable name (e.g.
<a href="../../input_variables/generated_files/varbas.html#ecut">ecut</a> ), appended with the
index of the dataset (e.g. <a href="../../input_variables/generated_files/varbas.html#jdtset">jdtset</a>=2),
exists (e.g. "ecut2" ) . It
will take the data that follows this keyword, if it exists.</li>
<li> (<a name="ref8_2"></a>2) If this modified variable name does not exist,
it will look whether a metacharacter, a series or a double-loop data set
has been defined, see sections
<a href=#series>series</a> or <a href=#loop>loop</a>.</li>
<li> (<a name="ref8_3"></a>3) If the variable name appended with the index
of the dataset does not exist, and if there is no series nor double-loop
dataset for this keyword, it looks for an occurrence of the variable name
without any index appended, and take the corresponding data. (This corresponds
to the single dataset mode)</li>
<li> (<a name="ref8_4"></a>4) If such occurrences do not exist, it takes the
default value. (Also, similar to the single dataset mode)</li>
</ul>
<pre>
---------------

1st example.

ndtset   2
acell   8 8 8
ecut1  10
ecut2  15
</pre>
means that there are 2 datasets : a first in which
<pre>     acell 8 8 8  ecut 10 </pre>
has to be used, and a second in which
<pre>     acell 8 8 8  ecut 15</pre>
has to be used.
<pre>
------------------

2nd example

ndtset 2     jdtset 4 5

acell   8 8 8
acell5 10 10 10
ecut1  10
ecut2  15
ecut3  20
ecut4  25
ecut5  30
</pre>
<p>this means that there are still two datasets, but now characterized by the
indices 4 and 5, so that the first run will use the generic "acell",
and "ecut4" :
<pre>     acell 8 8 8 ecut 25
</pre>
and the second run will use "acell5"
and "ecut5" :
<pre>     acell 10 10 10 ecut 30 </pre>
<p>Note that ecut1, ecut2 and ecut3 are not used. </p>
<h4>&nbsp;</h4>

<h4><a name="series"></a> Defining a series: </h4>

Rule (2) is split in three parts : (2a), (2b) and (2c).
<br> Series relate with (2b):
<p>
(<a name="ref8_2b"></a>2b) If the variable name appended with the index of the
dataset does not exist, the code looks whether a series has been defined for this
keyword.
<p>There are two kinds of series :
<ul>
<li>arithmetic series (constant <i>increment</i> between terms of the series)
<li> geometric series (constant <i>ratio</i> between terms of the series)
</ul>
<p>The first term of the series is defined by the keyword appended with a colon
(e.g. <b>ecut:</b> ), while the increment of an arithmetic series is defined
by the keyword appended with a plus (e.g. <b>ecut+</b> ), and the factor of
a geometric series is defined by the keyword appended with a times (e.g. <b>ecut*</b>
). </p>
<p>If the index of the dataset is 1, the first term of the series is used, while
for index N , the appropriate input data is obtained by considering the Nth
term of the series. </p>
<pre>
------------------

3rd example

ndtset 6
ecut1 10
ecut2 15
ecut3 20
ecut4 25
ecut5 30
ecut6 35
</pre>
is equivalent to
<pre>    ndtset 6 ecut: 10 ecut+ 5
</pre>
<p>In both cases, there are six datasets, with increasing values of <a href="../../input_variables/generated_files/varbas.html#ecut">ecut</a>.
</p>
<h4>&nbsp; </h4>

<h4><a name="loop"></a> Defining a double loop dataset: </h4>
<p>To define a double loop dataset, one has first to define the upper limit
of two loop counters, thanks to the variable <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>.
The inner loop will execute from 1 to <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>(2),
and the outer loop will execute from 1 to [[udtset](1).
Note that the largest value for <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>(1) is presently 999,
while it is 9 for <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>(2) (so, only the last digit for the inner loop). </p>
<p>The value of <a href="../../input_variables/generated_files/varbas.html#ndtset">ndtset</a> must
be coherent with <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a> (it
must equal the product <code>udtset(1)*udtset(2)</code> ). </p>
<p>A dataset index is created by the concatenation of the outer loop index and
the inner loop index. <br>
For example, if <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>(1)
is 2 and <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>(2) is 4,
the index will assume the following values : <code>11, 12, 13, 14, 21, 22,
23, and 24</code>.
<p> Independently of the use of <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>,
rules (2a) and (2c) will be used to define the value of an input variable: </p>
<p><a name="topic_multidtset.html#ref8_2a"></a>(2a) The question mark "<b>?</b>" can be used as a
metacharacter, replacing any digit from 1 to 9, to define an index of a dataset.
<br>
For example, <b>ecut?</b>1 means that the input value that follows it can
be used for <a href="../../input_variables/generated_files/varbas.html#ecut">ecut</a> for the datasets
<code>01, 11, 21, 31, 41, 51, 61, 71, 81, and 91</code>. </p>
<p><a name="topic_multidtset.html#ref8_2c"></a>(2c) If the variable name appended with the index of
the dataset does not exist, the code looks whether a double-loop series has
been defined for this keyword. Series can be defined for the inner loop index
or the outer loop index. Two signs will be appended to the variable name (instead
of one in the simple series case). One of these signs must be a question mark
"<b>?</b>", again used as a metacharacter able to assume the values 1 to 9.<br>
If it is found in the first of the two positions, it means that the series
does not care about the outer loop index (so the values generated are equal
for all outer loop index values). If it is found in the second of the two
positions, the series does not care about the inner loop index. The other
sign can be a colon, a plus or a times, as in the case of the series defined
in <a href="topic_multidtset.html#ref8_2a">(2a)</a>, with the same meaning. </p>
<p>Rule (<a href="topic_multidtset.html#ref8_1">1</a>) has precedence over them,
they have precedence over rules (<a href="topic_multidtset.html#ref8_3">3</a>) or
(<a href="topic_multidtset.html#ref8_4">4</a>), rule (<a href="topic_multidtset.html#ref8_2a">2a</a>)
has precedence over rules <a href="topic_multidtset.html#ref8_2b">(2b)</a> or <a href="topic_multidtset.html#ref8_2c">(2c)</a>
and the two latter cannot be used simultaneously for the same variable. </p>


<pre>
------------------

4th example
ndtset 6    udtset 2 3
acell1?  10 10 10
acell2?  15 15 15
ecut?: 5    ecut?+ 1
</pre>
is equivalent to
<pre>
ndtset 6     jdtset 11 12 13  21 22 23
acell11  10 10 10     ecut11 5
acell12  10 10 10     ecut12 6
acell13  10 10 10     ecut13 7
acell21  15 15 15     ecut21 5
acell22  15 15 15     ecut22 6
acell23  15 15 15     ecut23 7
</pre>
<p><i>More examples can be found in the directory ~abinit/tests/v1, cases 59 and later.</i>
</p>

<h4>&nbsp; </h4>

<h3><a name="2"></a>File names in the multi-dataset mode.</h3>

<p>The root names for input and output files (potential, density, wavefunctions
and so on) will receive an appendix : '<b>_DS</b>' followed by the index of
the dataset.  </p>
<p><a name="get">The '<b>get</b>' variables</a> can be used to chain the calculations. </p>

<p>The different variables corresponding to each dataset are echoed using the
same indexing convention as for the input step. For the last echo of the code
variables, some output variables are also summarized, using the same conventions
:
<ul>
<li><b>etotal</b> (total energy)
<li><b>fcart</b> (cartesian forces)
<li><b>strten</b> (the stress tensor).
</ul>



&nbsp; 
<HR ALIGN=left> 
<a name="2">&nbsp;</a>
<h3><b>2. Related input variables.</b></h3>


<p>Compulsory input variables:<p>... <a href="../../input_variables/generated_files/varbas.html#ndtset">ndtset</a>   [Number of DaTaSETs]<br>
<p>Basic input variables:<p>... <a href="../../input_variables/generated_files/varbas.html#jdtset">jdtset</a>   [index -J- for DaTaSETs]<br>
... <a href="../../input_variables/generated_files/varbas.html#udtset">udtset</a>   [Upper limit on DaTa SETs]<br>
<p>Useful input variables:<p>... <a href="../../input_variables/generated_files/varfil.html#get1wf">get1wf</a>   [GET the first-order wavefunctions from _1WF file ]<br>
... <a href="../../input_variables/generated_files/varfil.html#getbscoup">getbscoup</a>   [GET the Bethe-Salpeter COUPling block from ...]<br>
... <a href="../../input_variables/generated_files/varfil.html#getbseig">getbseig</a>   [GET the Bethe-Salpeter EIGenstates from ...]<br>
... <a href="../../input_variables/generated_files/varfil.html#getbsreso">getbsreso</a>   [GET the Bethe-Salpeter RESOnant block from ...]<br>
... <a href="../../input_variables/generated_files/varrlx.html#getcell">getcell</a>   [GET CELL parameters from ...]<br>
... <a href="../../input_variables/generated_files/varfil.html#getddk">getddk</a>   [GET the DDK wavefunctions from _1WF file]<br>
... <a href="../../input_variables/generated_files/varfil.html#getden">getden</a>   [GET the DENsity from ...]<br>
... <a href="../../input_variables/generated_files/vardev.html#getgam_eig2nkq">getgam_eig2nkq</a>   [GET the GAMma phonon data EIG2NKQ from dataset]<br>
... <a href="../../input_variables/generated_files/varfil.html#gethaydock">gethaydock</a>   [GET the HAYDOCK restart file from ...]<br>
... <a href="../../input_variables/generated_files/varfil.html#getocc">getocc</a>   [GET OCC parameters from ...]<br>
... <a href="../../input_variables/generated_files/varfil.html#getqps">getqps</a>   [GET QuasiParticle Structure]<br>
... <a href="../../input_variables/generated_files/varfil.html#getscr">getscr</a>   [GET SCReening (the inverse dielectric matrix) from ...]<br>
... <a href="../../input_variables/generated_files/varfil.html#getsuscep">getsuscep</a>   [GET SUSCEPtibility (the irreducible polarizability) from ...]<br>
... <a href="../../input_variables/generated_files/varrlx.html#getvel">getvel</a>   [GET VEL from ...]<br>
... <a href="../../input_variables/generated_files/varfil.html#getwfk">getwfk</a>   [GET the wavefunctions from _WFK file ]<br>
... <a href="../../input_variables/generated_files/vardev.html#getwfkfine">getwfkfine</a>   [GET the fine grid wavefunctions from _WFK file]<br>
... <a href="../../input_variables/generated_files/varfil.html#getwfq">getwfq</a>   [GET the wavefunctions from _WFQ file ]<br>
... <a href="../../input_variables/generated_files/varrlx.html#getxcart">getxcart</a>   [GET XCART from ...]<br>
... <a href="../../input_variables/generated_files/varrlx.html#getxred">getxred</a>   [GET XRED from ...]<br>


&nbsp; 
<HR ALIGN=left> 
<a name="3">&nbsp;</a>
<h3><b>3. Selected input files.</b></h3>


The user can find some related example input files in the ABINIT package in the directory /tests, or on the Web:
<p> tests/v1/Input: <a href="../../tests/v1/Input/t83.in">t83.in</a> 
<a href="../../tests/v1/Input/t84.in">t84.in</a> 
<a href="../../tests/v1/Input/t87.in">t87.in</a> 
<br>


<script type="text/javascript" src="../../js_files/list_internal_links_for_generated_files.js"> </script>

</body>
</html>

