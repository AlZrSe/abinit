# Crystalline aluminum : testing of many hybrid functionals (variations of the hyb_* input variables,
# as well as downsampling, for HSE06, PBE0, HSE03.

 ndtset 14

#Definition of the k-point grid
 ngkpt  3*2      # This is a 2x2x2 FCC grid, based on the primitive vectors
 nshiftk 4  shiftk 0.0 0.0 0.0  0.0 0.5 0.5  0.5 0.0 0.5  0.5 0.5 0.0

#k-point downsampling for Fock operator
 fockdownsampling 3*2    

 nstep 15          # Maximal number of SCF cycles
 toldfe 1.0d-8     # Will stop when, twice in a row, the difference

#DATASET 1  PBE (the pseudopotential for Al is with LDA)
 ixc1  11

#DATASET 2  HSE06 (LibXC)
 ixc2  -428

#DATASET 3  PBE0
 ixc3  41

#DATASET 4  HSE03 (LibXC)
 ixc4  -427

#DATASET 5  HSE03 (VASP)
 ixc5  -427
 hyb_range_fock5 0.1587531

#DATASET 6  HSE06 (VASP)
 ixc6  -428
 hyb_range_fock6 0.105835

#DATASET 7  HSE06 (Espresso)
 ixc7  -428
 hyb_range_fock7 0.106

#DATASET 8  HSE03 (LibXC) Fool LibXC by imposing to HSE06 the HSE03 parameters
# So, gives the same as dataset 4
 ixc8  -428                              # This should be HSE06
 hyb_range_fock8 0.106066                # But these lines redefine the parameters to the libxc HSE03
 hyb_range_dft8 0.188988                

#DATASET 9  HSE06 (LibXC) Fool LibXC by imposing to HSE03 the HSE06 parameter(s)
# So, gives the same as dataset 2
 ixc9  -427                              # This should be HSE03
 hyb_range_fock9 0.11                    # But this redefines the parameters to the libxc HSE06

#DATASET 10  PBE0 Fool ABINIT by imposing to PBE0-1/3 the PBE0 parameter
# So, gives the same as dataset 3
 ixc10 42                             # This should be PBE-1/3 (with hyb_mixing 1/3)
 hyb_mixing10 0.25                    # But this redefines the parameter to the PBE0

#DATASET 11  PBE0 Fool ABINIT by imposing to PBE0-1/3 the PBE0 parameter
# So, gives the same as dataset 3
 ixc11 -456                           # This should be PBE-1/3 (with hyb_mixing 1/3)
 hyb_mixing11 0.25                    # But this redefines the parameter to the PBE0

#DATASET 12  PBE (LibXC) Fool LibXC by imposing to HSE06 an extremely small mixing
# So, gives the same as dataset 1
 ixc12 -428                           # This should be HSE06
 hyb_mixing_sr12 0.00000002           # But this redefines the parameter to the PBE, with a small difference

#DATASET 13  PBE (LibXC) Fool LibXC by imposing to HSE06 an extremely small mixing
# So, gives the same as dataset 1
 ixc13 -428                           # This should be HSE06
 hyb_mixing_sr13 0.00000004           # But this redefines the parameter to the PBE, with a small difference

#DATASET 14 PBE from LibXC
# Gives the same as dataset 1
 ixc14  -130101

#
 getwfk1 0
 getwfk  1

#Definition of occupation numbers
occopt 7
tsmear 0.04

#Definition of the unit cell
acell 3*7.60           # This is equivalent to   7.60 7.60 7.60
rprim  0.0  0.5  0.5   # FCC primitive vectors (to be scaled by acell)
       0.5  0.0  0.5
       0.5  0.5  0.0

#Definition of the atom types
ntypat 1          # There is only one type of atom
znucl 13          # The keyword "znucl" refers to the atomic number of the
                  # possible type(s) of atom. The pseudopotential(s)
                  # mentioned in the "files" file must correspond
                  # to the type(s) of atom. Here, the only type is Aluminum


#Definition of the atoms
natom 1           # There is only one atom per cell
typat 1           # This atom is of type 1, that is, Aluminum
xred              # This keyword indicate that the location of the atoms
                  # will follow, one triplet of number for each atom
   0.0  0.0  0.0     # Triplet giving the REDUCED coordinate of atom 1.

#Definition of the planewave basis set
ecut  6.0         # Maximal kinetic energy cut-off, in Hartree

## After modifying the following section, one might need to regenerate the pickle database with runtests.py -r
#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% [files]
#%% files_to_test =
#%%   t72.out, tolnlines=  1, tolabs=  4.0e-10, tolrel=  2.0e-04
#%% psp_files = 13al.pspgth
#%% [paral_info]
#%% max_nprocs = 4
#%% [extra_info]
#%% authors = X. Gonze
#%% keywords =
#%% description =
#%%   Crystalline aluminum, primitive cell. Test of downsampling for HSE06, PBE0, HSE03.
#%%   2x2x2 with 4 shifts for the k point grid in the FBZ
#%%   1x1x1 with 4 shifts for the k point grid for the Fock operator in the FBZ
#%%   Tests were performed with a k-point grid 16x16x16 (without additional shift),
#%%   to try to recover the nice behaviour of the HSE03 with down sampling 
#%%   shown in Marsman et al JPCM 20, 064201 (2008), Fig. 1 (there, the reference was 24x24x24)
#%%   In all the cases (HSE03 libxc, HSE03 VASP, HSE06 - even clearing the issue with the definition of HSE03 dataset 4&5)
#%%   the downsampling does NOT perform well ...
#%%<END TEST_INFO>
