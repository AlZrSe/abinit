# HF calculation with NC pseudos, nspinor in [1, 2], no SOC
ndtset 6
#gwpara 1

nband     16
ecut      8
ecutsigx  8 
tolwfr    1e-10

#kptopt   4
nshiftk  1
shiftk   0 0 0
ngkpt    4 4 4 

#################
### DATASET 1 ###
#################
# spin-unpolarized GS
nband1    8
nspinor1  1 nsppol1  1 nspden1  1 so_psp1 *0

#################
### DATASET 2 ###
#################
# non-collinear GS without SOC. Init wfs from previous WFK file.
getwfk2    1
nband2     16
nspinor2   2 nsppol2  1 nspden2  4 so_psp2 *0

#################
### DATASET 3 ###
#################
# spin-unpolarized HF from WFK produced in Dataset 1 
nspinor3  1 nsppol3  1 nspden3  1 so_psp3 *0
nband3    8
optdriver3  4
gwcalctyp3  5  # HF
getwfk3     1
bdgw3       1 6
            1 6

#################
### DATASET 4 ###
#################
# non-collinear HF without SOC. Start from WFK produced in Dataset 2 
# without no SOC --> HF energies should be equivalent to those in DATASET 3
nspinor4  2 nsppol4  1 nspden4  4 so_psp4 *0
optdriver4  4
gwcalctyp4  5  # HF
getwfk4     2
bdgw4       1 12
            1 12

#################
### DATASET 5 ###
#################
# non-collinear GS with SOC. Init wfs from dataset 2
getwfk5    2
nband5     16
nspinor5   2 nsppol5  1 nspden5  4 so_psp5 *1


#################
### DATASET 6 ###
#################
# non-collinear HF with SOC from WFK produced in Dataset 2
nspinor6  2 nsppol6  1 nspden6  4 so_psp6 *1
optdriver6  4
gwcalctyp6  5  # HF
getwfk6     5
bdgw6       1 12
            1 12


# GW globals
symsigma    0     # Disable symmetrization in self-energy
nkptgw      2
kptgw
    0 0 0 
    0.5 0 0 

# Definition of the unit cell: fcc
acell  3*10.217        
rprim  0.0  0.5  0.5   # FCC primitive vectors (to be scaled by acell)
       0.5  0.0  0.5
       0.5  0.5  0.0

# Definition of the atom types
ntypat 1          
znucl 14         

# Definition of the atoms
natom 2           
typat 1 1         
xred              
   0.0  0.0  0.0
   0.25 0.25 0.25

#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% [files]
#%% files_to_test =
#%%  t60.out, tolnlines = 20, tolabs = 1.1e-2, tolrel = 4.0e-2;
#%% psp_files = Si_r.psp8
#%% [paral_info]
#%% max_nprocs = 4
#%% [extra_info]
#%% authors = M. Giantomassi
#%% keywords = NC, GW, SOC
#%% description = 
#%%   HF calculation with NC pseudos, nspinor in [1, 2], no SOC
#%%   as well as WFK IO and wafunction conversion nspinor 1 --> nspinor 2
#%%   QP results should not depend on nspinor
#%%<END TEST_INFO>
